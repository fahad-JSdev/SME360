<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../accounts/Product.js"></script>
<script src="../accounts/Receipt.js"></script>
<link rel="stylesheet" href="../assets/themes/autoSearchText.css" />
<link rel="stylesheet" href="../assets/themes/gst_invoice.css" />
<script src="../widgets/autoSearchText.js"></script>

<title>SALES RETURN</title>

<body>
  <div class="form" id="form">
    <form>
      <div class="client">
        <table class="top-table">
          <tr>
            <td>
              <label for="client">Client &emsp;</label>
              <input type="text" id="client" name="client" />
            </td>
            <td>
              <label for="docunum">Return Number &emsp;</label>
              <input type="text" id="docunum" name="docunum" />
            </td>
            <td>
              <label id="orderno-label" for="orderno"
                >Invoice Number &emsp;</label
              >
              <input type="text" id="orderno" name="orderno" />
            </td>
          </tr>
          <tr>
            <td>
              <label for="ship">Ship To &emsp;</label>
              <input type="text" id="ship" name="ship" />
            </td>
            <td>
              <label for="issue-dt">Date &emsp;</label>
              <input
                type="date"
                id="issue-dt"
                name="issue-dt"
                oninput="setPaymentTermsEmpty()"
                contenteditable
              />
            </td>
            <td>
              <label id="orderdt-label" for="order-dt"
                >Invoice Date &emsp;</label
              >
              <input
                type="date"
                id="order-dt"
                name="order-dt"
                contenteditable
              />
            </td>
          </tr>
          <tr>
            <td>
              <label for="terms">Payment Terms</label>
              <select
                name="Payment Terms"
                id="terms"
                onchange="DateChangeOnTerms(event)"
              >
                <option disabled="" selected=""></option>
                <option id="op" value="NET 7">NET 7</option>
                <option id="op" value="NET 15">NET 15</option>
                <option id="op" value="NET 30">NET 30</option>
                <option id="op" value="Specific Date">Specific Date</option>
                <option id="op" value="Hide">Hide Payment Terms</option>
              </select>
            </td>
            <td id="dueDateCell">
              <label for="due-dt">Valid Until &emsp;</label>
              <input type="date" id="due-dt" name="due-dt" contenteditable />
            </td>
            <td>
              <label for="supply-select">Place of Supply &emsp;</label>
              <input type="text" id="supply-select" />
            </td>
          </tr>
        </table>
      </div>
      <article class="invoicebody">
        <!-- <div class="button-div">
          <button type="button" id="add-client" onclick="addClientWin()">Add Client</button>
          <button type="button" id="add-item" onclick="addItemWin()">Add Item</button>
          <button type="button" class="add" onclick="addRowIfnotLastcolumnnotempty('sale-table')">
            <img src="../assets/images/addrow.png" />
          </button>
          <button type="button" id="delete-row" onclick="deleteRow()">
            <img src="../assets/images/reject2.png" />
          </button>
        </div> -->
        <div class="min_height">
          <table class="inventory" id="sale-table">
            <thead>
              <tr>
                <th class="bold" rowspan="2">
                  <span class="no" id="no">No.</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="item" id="item">Product/Service</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="batch" id="batch">BATCH NO.</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="description" id="description">Description</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="hsn" id="hsn">HSN/SAC</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="uom" id="uom">Unit</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="quantity" id="quantity">Quantity</span>
                </th>
                <th class="bold" rowspan="2" id="return">
                  <span class="quantity" id="quantity">RETURN</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="unitprice" id="unitprice">Unit Price</span>
                </th>
                <th class="bold" colspan="2">
                  <span class="discount" id="discount">Discount</span>
                </th>
                <th class="bold" colspan="2">
                  <span class="cgst" id="cgst">CGST</span>
                </th>
                <th class="bold" colspan="2">
                  <span class="sgst" id="sgst">SGST</span>
                </th>
                <th class="bold" colspan="2">
                  <span class="igst" id="igst">IGST</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="value" id="value">Amount</span>
                </th>
                <th class="bold" rowspan="2">
                  <span class="exp-dt" id="exp-dt">EXPIRY DATE</span>
                </th>
              </tr>
              <tr>
                <th class="bold header">
                  <span class="disc-perc" id="disc-perc">%</span>
                </th>
                <th class="bold header">
                  <span class="disc-amount" id="disc-amount">AMOUNT</span>
                </th>
                <th class="bold header">
                  <span class="cgst-perc" id="cgst-perc">%</span>
                </th>
                <th class="bold header">
                  <span class="cgst-amount" id="cgst-amount">AMOUNT</span>
                </th>
                <th class="bold header">
                  <span class="sgst-perc" id="sgst-perc">%</span>
                </th>
                <th class="bold header">
                  <span class="cgst-amount" id="cgst-amount">AMOUNT</span>
                </th>
                <th class="bold header">
                  <span class="igst-perc" id="igst-perc">%</span>
                </th>
                <th class="bold header">
                  <span class="igst-amount" id="igst-amount">AMOUNT</span>
                </th>
              </tr>
            </thead>
            <tbody id="sale-tbody"></tbody>
          </table>
        </div>
        <div class="right_tax">
          <table class="balance" id="balance">
            <tbody>
              <tr>
                <th class="bold">
                  <span class="total" id="total">Total</span>
                </th>
                <td><span>&#8377; </span><span id="grandtotal"></span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>
      <div class="right_btn">
        <button type="button" class="print_btn" onclick="myprint()">
          <img src="../assets/images/toolbar-print.png" />
        </button>
        <button
          type="button"
          class="print_btn"
          onClick="window.location.reload()"
        >
          <img src="../assets/images/restarticon.png" />
        </button>
        <button type="button" id="save-button" onclick="invoiceSubmit()">
          <img src="../assets/images/save-icon.png" />
        </button>
      </div>
      <div class="bottom-box">
        <input
          type="checkbox"
          id="disc-all"
          name="disc-all"
          value="disc-all"
          oninput="discountAllBox()"
        />
        <label for="disc-all">Discount on All</label>
        <input type="number" id="disc-all-ip" oninput="getDiscount()" />
        <br /><br /><br />
        <input
          type="checkbox"
          id="ship-cost"
          name="ship-cost"
          value="ship-cost"
          onclick="packageCostBox()"
        />
        <label for="rs-ship-box">Add Shipping & Packaging Costs</label>&emsp;
        <input type="number" id="rs-ship-box" oninput="getPackageCost()" />
        <br /><br /><br />
        <input
          type="checkbox"
          id="round-off"
          name="round-off"
          value="round-off"
          onclick="RoundOff(event)"
        />
        <label for="round-off">Round off Total</label><br /><br /><br />
        <input
          type="checkbox"
          id="Apply-TDS"
          name="Apply-TDS"
          value="Apply-TDS"
        />
        <select name="Apply-TDS" id="tds">
          <option>Apply TDS</option>
          <option id="op" value="value1">Apply TCS</option>
          <option id="op" value="value2">Apply TCS 206C(1H)</option></select
        ><br /><br />
        <div id="left-box">
          <input
            type="checkbox"
            id="add-pay"
            name="add-pay"
            value="add-pay"
            onclick="addPaymentBox()"
          />
          <label for="add-pay" id="addpay-label">Add Payment</label
          ><br /><br /><br />
        </div>
        <div id="right-box">
          <label for="paytype" id="paytype-label">Payment Type</label>
          <select name="Payment Type" id="paytype">
            <option disabled="" selected=""></option>
            <option id="op" value="Cash">Cash</option>
            <option id="op" value="Cash Memo">Cash Memo</option>
            <option id="op" value="Credit Card">Credit Card</option>
            <option id="op" value="Cheque">Cheque</option>
            <option id="op" value="bank">Bank Transfer</option>
            <option id="op" value="pay slip">Pay Slip</option>
            <option id="op" value="other">Other</option>
          </select>
          <input type="number" id="amt-paid-input" placeholder="Amount Paid" />
        </div>
      </div>
    </form>
  </div>
</body>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const dataString = urlParams.get("data");
  var click_id = JSON.parse(decodeURIComponent(dataString));
  document.getElementById("orderno").value = clickdata_id[0];

  var issueDate = document.getElementById("issue-dt");
  var dueDate = document.getElementById("due-dt");
  var paymentTerms = document.getElementById("terms");
  var dueDateCell = document.getElementById("dueDateCell");
  var packagecost = document.getElementById("rs-ship-box");
  var discCheck = document.getElementById("disc-all");
  var discountALL = document.getElementById("disc-all-ip");
  var saleTable = document.getElementById("sale-table");
  var sale_tbody = document.getElementById("sale-tbody");
  var docunum = document.getElementById("docunum");
  var client = document.getElementById("client");
  var ordernum = document.getElementById("orderno");
  var orderDate = document.getElementById("order-dt");
  var shipTo = document.getElementById("ship");
  var supplyPlace = document.getElementById("supply-select");
  var grandTotal = document.getElementById("grandtotal");
  window.MainDatastream.streamGetDataOnce(
    "SELECT customer.client_name,q.id,q.enq_no,q.enq_date,q.ship_to,q.issue_date,q.due_date,q.place_of_supply,q.pay_terms,q.total_amount,q.total_disc,q.shiping_charge,qlist.stk_name,stock.stock_id,stock.item_description,stock.hsn_code,qlist.batch_no,qlist.unit,qlist.quant,qlist.price_unit,qlist.cgst_tax,qlist.sgst_tax,qlist.discount,qlist.amount,qlist.exp_dat,qlist.cgst_tax_amt,qlist.sgst_tax_amt,qlist.disc_amt,q.customer_f_key FROM quotation AS q LEFT JOIN customer ON customer.client_id = q.customer_f_key LEFT JOIN quotation_list AS qlist ON q.id = qlist.quot_f_id LEFT JOIN stock ON qlist.stock_f_id = stock.stock_id WHERE q.id=" +
      clickdata_id[0] +
      ";",
    (status, data) => {
      this.rowLength = JSON.parse(data).data.length;

      console.log("data for purchase bill table=>", JSON.parse(data).data);
      var pon = document.getElementById("pBnumber");

      // var issue = document.getElementById("issue-dt");
      // var bill_dat = document.getElementById("bill_dat");
      // var payment = document.getElementById("payment-select");
      // var partydt = document.getElementById("partydt");
      // var desp = document.getElementById("desp");
      // var disc = document.getElementById("granddisc");
      // var gTotal = document.getElementById("grandtotal");

      issue.value = JSON.parse(data).data[0][1];
      bill_dat.value = JSON.parse(data).data[0][2];
      payment.value = JSON.parse(data).data[0][5];
      partydt.value = JSON.parse(data).data[0][15];
      console.log("payment value=>", JSON.parse(data).data[0][5]);
      console.log("description value=>", JSON.parse(data).data[0][6]);
      console.log("discount value=>", JSON.parse(data).data[0][4]);
      desp.value = JSON.parse(data).data[0][6];
      disc.value = JSON.parse(data).data[0][4];
      gTotal.innerHTML = JSON.parse(data).data[0][3];
      // partydt.selectedItemId = JSON.parse(data).data[0][21];
      pon.disabled = true;
      issue.disabled = true;
      bill_dat.disabled = true;
      payment.disabled = true;
      desp.disabled = true;
      disc.disabled = true;

      partydt.disabled = true;

      for (var i = 0; i < JSON.parse(data).data.length; i++) {
        CreateRow("myTable");

        console.log("data types=>", typeof JSON.parse(data).data[i][16]);

        console.log("table data=>", JSON.parse(data).data[i]);
        a.rows[i + 2].cells[1].firstChild.value = JSON.parse(data).data[i][7];
        a.rows[i + 2].cells[1].firstChild.stockId =
          JSON.parse(data).data[i][18];
        a.rows[i + 2].cells[1].firstChild.listId = JSON.parse(data).data[i][19];
        a.rows[i + 2].cells[2].firstChild.value = JSON.parse(data).data[i][8];
        a.rows[i + 2].cells[3].firstChild.value = JSON.parse(data).data[i][9];
        a.rows[i + 2].cells[4].firstChild.value = JSON.parse(data).data[i][10];
        a.rows[i + 2].cells[4].firstChild.retVal = JSON.parse(data).data[i][20];
        a.rows[i + 2].cells[6].firstChild.value = JSON.parse(data).data[i][11];
        a.rows[i + 2].cells[7].firstChild.value = JSON.parse(data).data[i][12];
        a.rows[i + 2].cells[8].firstChild.value = JSON.parse(data).data[i][16];
        a.rows[i + 2].cells[10].firstChild.value = JSON.parse(data).data[i][13];
        a.rows[i + 2].cells[12].firstChild.value = JSON.parse(data).data[i][14];
        console.log("total value=>", JSON.parse(data).data[i][14]);
        console.log("return function", JSON.parse(data).data[i]);
        a.rows[i + 2].cells[1].firstChild.disabled = true;
        a.rows[i + 2].cells[2].firstChild.disabled = true;
        a.rows[i + 2].cells[3].firstChild.disabled = true;
        a.rows[i + 2].cells[4].firstChild.disabled = true;
        a.rows[i + 2].cells[5].firstChild.disabled = false;
        a.rows[i + 2].cells[6].firstChild.disabled = true;
        a.rows[i + 2].cells[7].firstChild.disabled = true;
        a.rows[i + 2].cells[8].firstChild.disabled = true;
        a.rows[i + 2].cells[9].firstChild.disabled = true;

        // var p = new Product(
        //   //stock_id //list_id
        //   [JSON.parse(data).data[i][18], JSON.parse(data).data[i][19]], // id
        //   JSON.parse(data).data[i][7], //name
        //   JSON.parse(data).data[i][11], //unit
        //   parseFloat(JSON.parse(data).data[i][12]), //price
        //   parseFloat(JSON.parse(data).data[i][16]), //discount
        //   parseFloat(JSON.parse(data).data[i][13]), //tax
        //   JSON.parse(data).data[i][17], //details
        //   JSON.parse(data).data[i][8], //batch_no
        //   JSON.parse(data).data[i][9] //expiry_dat
        // );
        // mReceipt.addproduct(p);
        // mReceipt
        //   .getProducts()
        //   [i].setQuantity(parseFloat(JSON.parse(data).data[i][12]));
        // a.rows[i + 2].cells[9].firstChild.value = mReceipt
        //   .getProducts()
        //   [i].getDiscountamount();
        // a.rows[i + 2].cells[11].firstChild.value = mReceipt
        //   .getProducts()
        //   [i].getTaxAmount();
        // console.log("object5=>", mReceipt.getProducts()[i]);
        //==========================================

        // if (JSON.parse(data).data[i][20] == "1") {
        //   console.log("return function called");
        //   a.rows[i + 2].cells[0].firstChild.checked = true;
        //   a.rows[i + 2].cells[0].firstChild.disabled = true;
        //   a.rows[i + 2].cells[4].firstChild.disabled = true;

        //   a.rows[i + 2].cells[1].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[2].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[3].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[4].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[5].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[6].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[7].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[9].firstChild.style.textDecoration =
        //     "line-through";
        //   a.rows[i + 2].cells[11].firstChild.style.textDecoration =
        //     "line-through";
        // }

        var p = new Product(
          //stock_id //list_id
          [JSON.parse(data).data[i][18], JSON.parse(data).data[i][19]], // id
          JSON.parse(data).data[i][7], //name
          JSON.parse(data).data[i][11], //unit
          parseFloat(JSON.parse(data).data[i][12]), //price
          parseFloat(JSON.parse(data).data[i][16]), //discount
          parseFloat(JSON.parse(data).data[i][13]), //tax
          JSON.parse(data).data[i][17], //details
          JSON.parse(data).data[i][8], //batch_no
          JSON.parse(data).data[i][9] //expiry_dat
        );
        mReceipt.addproduct(p);
        mReceipt
          .getProducts()
          [i].setQuantity(parseFloat(JSON.parse(data).data[i][10]));
        a.rows[i + 2].cells[9].firstChild.value = mReceipt
          .getProducts()
          [i].getDiscountamount();
        a.rows[i + 2].cells[11].firstChild.value = mReceipt
          .getProducts()
          [i].getTaxAmount();
      }
    }
  );
  var numberofselectedrows = 0;
  var deleteIndex = [];
  var value;
  var count = 0;
  ///////////////////VARIABLES//////////////////////////
  document
    .getElementsByTagName("body")[0]
    .addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        console.log("keypress called");
        addRowIfnotLastcolumnnotempty("myTable");
        event.preventDefault();
      }
    });

  window.MainDatastream.streamGetData(
    "SELECT ireturn_id FROM invoice_return ORDER BY ireturn_id DESC LIMIT 1 ;",
    (status, data) => {
      docunum.value = parseInt(JSON.parse(data).data[0]) + 1;
    }
  );
  document.getElementById("return").style.display = "none";
  window.MainDatastream.streamAddBill(
    "SELECT st.stock_id,stc.product,st.bach_no,st.item_description,st.hsn_code,st.unit,st.sales_price,st.discount,stc.tax_per,st.expiry FROM stock AS st LEFT JOIN stock_collection AS stc ON stc.product_id=st.stock_f_id",
    (status, data) => {
      this.searchVal = JSON.parse(data).data;
      addRowIfnotLastcolumnnotempty("sale-table");
    }
  );

  function myprint() {
    window.print();
  }

  var mReceipt = new Receipt();
  function addRowIfnotLastcolumnnotempty(table_id) {
    var table = document.getElementById(table_id);
    if (table.rows.length - 2 == mReceipt.getProducts().length) {
      CreateRow(table_id);
    }
  }
  function CreateRow(table_id) {
    count = 0;
    var sale_table = document.getElementById(table_id);
    var sale_tbody = document.getElementById("sale-tbody");
    var row = sale_tbody.insertRow(sale_table.rows.length - 2);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    var cell4 = row.insertCell(3);
    var cell5 = row.insertCell(4);
    var cell6 = row.insertCell(5);
    var cell7 = row.insertCell(6);
    var cell8 = row.insertCell(7);
    var cell9 = row.insertCell(8);
    var cell10 = row.insertCell(9);
    var cell11 = row.insertCell(10);
    var cell12 = row.insertCell(11);
    var cell13 = row.insertCell(12);
    var cell14 = row.insertCell(13);
    var cell15 = row.insertCell(14);
    var cell16 = row.insertCell(15);
    var cell17 = row.insertCell(16);
    var cell18 = row.insertCell(17);
    var cell18 = row.insertCell(18);
    cell8.className = "rowsix";
    cell8.style.display = "none";
    cell1.append(this.createInputCheckbox("cell1"));
    cell2.append(this.createInputtext("cell2"));
    cell3.append(this.createInputBatchSelect("cell3"));
    cell4.append(this.createInputtextDisabled("cell4"));
    cell5.append(this.createInputtextDisabled("cell5"));
    cell6.append(this.createInputtextDisabled("cell6"));
    cell7.append(this.createInputNumber("cell7"));
    cell8.append(this.createInputNumber("rowsix"));
    cell9.append(this.createInputNumber("cell8"));
    cell10.append(this.createInputSelect("cell9"));
    cell11.append(this.createInputNumber("cell10"));
    cell12.append(this.createInputSelect("cell11"));
    cell13.append(this.createInputNumber("cell12"));
    cell14.append(this.createInputSelect("cell13"));
    cell15.append(this.createInputNumber("cell14"));
    cell16.append(this.createInputSelect("cell15"));
    cell17.append(this.createInputNumber("cell16"));
    cell18.append(this.createInputNumber("cell17"));
    cell19.append(this.createInputtextDisabled("cell18"));

    sale_table.oninput = (event) => {
      this.AddProduct(event);
    };
  }
  var rowsix = document.getElementsByClassName("rowsix");

  /////CreateRow Helper functions
  function createInputBatchSelect(id) {
    var SelectType = document.createElement("select");
    SelectType.id = id;
    SelectType.className = "batchselect";
    // SelectType.disabled = true;

    return SelectType;
  }
  function createInputCheckbox(id) {
    var checkType = document.createElement("input");
    checkType.type = "checkbox";
    checkType.id = id;
    checkType.addEventListener("click", (event) => {
      if (event.target.checked) {
        numberofselectedrows++;
      } else {
        numberofselectedrows--;
      }
      if (numberofselectedrows > 0) {
        document.getElementById("return").style.display = "table-cell";
        for (var i = 0; i < rowsix.length; i++) {
          rowsix[i].style.display = "table-cell";
        }
      } else {
        document.getElementById("return").style.display = "none";
        for (var i = 0; i < rowsix.length; i++) {
          rowsix[i].style.display = "none";
        }
      }
    });
    return checkType;
  }
  function createInputtext(id) {
    var textType = document.createElement("input");
    textType.type = "text";
    textType.id = id;
    return textType;
  }
  function createInputtextDisabled() {
    var textType = document.createElement("input");
    textType.type = "text";
    textType.disabled = true;
    return textType;
  }
  function createInputNumber(id) {
    var numType = document.createElement("input");
    numType.type = "number";
    numType.id = id;
    numType.min = "0";
    numType.disabled = true;
    return numType;
  }
  function createInputSelect(id) {
    var SelectType = document.createElement("select");
    SelectType.id = id;
    // SelectType.disabled = true;
    var selectarray = [0, 2.5, 5, 12, 15, 18, 28];
    for (var i = 0; i < 6; i++) {
      var optionApp = document.createElement("option");
      optionApp.value = selectarray[i];
      optionApp.innerHTML = selectarray[i];
      SelectType.appendChild(optionApp);
    }
    return SelectType;
  }
  var gTotal = document.getElementById("grandtotal");
  function AddProduct(event) {
    let cell = event.target;
    let rowIndex = cell.parentNode.parentNode.rowIndex;
    let cellIndex = cell.parentNode.cellIndex;
    switch (cellIndex) {
      case 7:
        mReceipt
          .getProducts()
          [rowIndex - 2].setQuantity(
            a.rows[rowIndex].cells[6].firstChild.value -
              a.rows[rowIndex].cells[7].firstChild.value
          );
        saleTable.rows[rowIndex].cells[16].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getTotal();
        gTotal.innerHTML = mReceipt.getGrandTotal();
        saleTable.rows[rowIndex].cells[11].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getCgstAmount();
        saleTable.rows[rowIndex].cells[13].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getSgstAmount();
        saleTable.rows[rowIndex].cells[9].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getDiscountamount();
        break;
      case 5:
        mReceipt
          .getProducts()
          [rowIndex - 2].setUnit(a.rows[rowIndex].cells[4].firstChild.value);

        saleTable.rows[rowIndex].cells[16].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getTotal();
        gTotal.innerHTML = mReceipt.getGrandTotal();
        saleTable.rows[rowIndex].cells[11].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getCgstAmount();
        saleTable.rows[rowIndex].cells[13].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getSgstAmount();
        saleTable.rows[rowIndex].cells[9].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getDiscountamount();
        break;
      case 8:
        mReceipt
          .getProducts()
          [rowIndex - 2].setDiscount(
            saleTable.rows[rowIndex].cells[8].firstChild.value
          );
        saleTable.rows[rowIndex].cells[16].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getTotal();
        gTotal.innerHTML = mReceipt.getGrandTotal();
        saleTable.rows[rowIndex].cells[11].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getCgstAmount();
        saleTable.rows[rowIndex].cells[13].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getSgstAmount();
        saleTable.rows[rowIndex].cells[9].firstChild.value = mReceipt
          .getProducts()
          [rowIndex - 2].getDiscountamount();
        break;
      case 2:
        mReceipt
          .getProducts()
          [rowIndex - 2].setbatch(a.rows[rowIndex].cells[2].firstChild.value);
        break;
      case 17:
        mReceipt
          .getProducts()
          [rowIndex - 2].setExpiry(a.rows[rowIndex].cells[17].firstChild.value);
        break;
    }
  }
  function selectColumnFill(product, a, rowIndex) {
    (a.rows[rowIndex].cells[3].firstChild.value = product[3]),
      (a.rows[rowIndex].cells[4].firstChild.value = product[4]),
      (a.rows[rowIndex].cells[5].firstChild.value = product[5]);
    a.rows[rowIndex].cells[7].firstChild.value = product[6];
    // a.rows[rowIndex].cells[9].firstChild.value = product[7];
    var batchQuery =
      "SELECT stock.bach_no FROM stock LEFT JOIN stock_collection AS stc ON stock.stock_f_id=stc.product_id WHERE stc.product = " +
      "'" +
      product[1] +
      "'" +
      ";";
    window.MainDatastream.streamGetData(batchQuery, (status, data) => {
      this.selectarray = JSON.parse(data).data;
      if (this.selectarray) {
        BatchAppend(saleTable, this.selectarray);
      }
    });
    a.rows[rowIndex].cells[10].firstChild.value = product[8] / 2;
    a.rows[rowIndex].cells[12].firstChild.value = product[8] / 2;
    a.rows[rowIndex].cells[17].firstChild.value = product[9];
  }

  function BatchAppend(a, selectarr) {
    console.log("SelectArray........", selectarr);
    console.log(
      "a.rows[rowIndex].cells[7].firstChild",
      a.rows[a.rows.length - 1].cells[2].firstChild
    );
    if (count < selectarr.length) {
      for (var i = 0; i < selectarr.length; i++) {
        var optionApp = document.createElement("option");
        // optionApp.value = selectarr[i];
        optionApp.innerHTML = selectarr[i];
        a.rows[a.rows.length - 1].cells[2].firstChild.appendChild(optionApp);
        count++;
      }
    }
  }
  var deletedRowId = [];
  function deleteRow() {
    numberofselectedrows = 0;
    document.getElementById("delete-row").style.display = "none";
    for (var i = 2; i < saleTable.rows.length; i++) {
      if (saleTable.rows[i].cells[0].firstChild.checked) {
        deleteIndex.push(i);
        if (i < this.rowLength + 2 && click_id[1] == "convert") {
          deletedRowId.push(a.rows[i].cells[1].firstChild.stockId);
          this.rowLength--;
        }
      }
    }
    for (var i = deleteIndex.length - 1; i > -1; i--) {
      saleTable.rows[deleteIndex[i]].remove();
      mReceipt.deleteProduct(deleteIndex[i] - 2);
    }
    deleteIndex = [];
    gTotal.innerHTML = mReceipt.getGrandTotal();
  }
  function DateChangeOnTerms(event) {
    dueDate.readOnly = true;
    if (event.target.value == "NET 7") {
      var date = new Date(issueDate.valueAsDate);
      date.setDate(date.getDate() + 7);
      dueDate.valueAsDate = date;
    } else if (event.target.value == "NET 15") {
      var date = new Date(issueDate.value);
      date.setDate(date.getDate() + 15);
      dueDate.valueAsDate = date;
    } else if (event.target.value == "NET 30") {
      var date = new Date(issueDate.value);
      date.setDate(date.getDate() + 30);
      dueDate.valueAsDate = date;
    } else if (event.target.value == "Specific Date") {
      dueDate.value = "";
      dueDate.readOnly = false;
    }
    // Another If Statement
    if (event.target.value == "Hide") {
      dueDateCell.style.display = "none";
    } else {
      dueDateCell.style.display = "revert";
    }
  }
  function setPaymentTermsEmpty() {
    paymentTerms.value = "";
    dueDate.value = "";
  }
  function currentDate(datId) {
    datId.valueAsDate = new Date();
  }
  currentDate(document.getElementById("issue-dt"));
  function getDiscount() {
    mReceipt.setDiscount(+discountALL.value);
    gTotal.innerHTML = mReceipt.getGrandTotal();
  }
  function getPackageCost() {
    mReceipt.setPackageCost(+packagecost.value);
    gTotal.innerHTML = mReceipt.getGrandTotal();
  }
  function addPaymentBox() {
    var checkBox = document.getElementById("add-pay");
    var text = document.getElementById("right-box");
    if (checkBox.checked == true) {
      text.style.display = "block";
    } else {
      text.style.display = "none";
    }
  }
  function packageCostBox() {
    var checkBox2 = document.getElementById("ship-cost");
    if (checkBox2.checked == true) {
      packagecost.style.display = "inline-block";
    } else {
      packagecost.style.display = "none";
      packagecost.value = "";
      mReceipt.setPackageCost(0);
      gTotal.innerHTML = mReceipt.getGrandTotal();
    }
  }
  function discountAllBox() {
    var checkBox2 = document.getElementById("disc-all");
    if (checkBox2.checked == true) {
      discountALL.style.display = "inline-block";
    } else {
      discountALL.style.display = "none";
      discountALL.value = "";
      mReceipt.setDiscount(0);
      gTotal.innerHTML = mReceipt.getGrandTotal();
    }
  }
  function RoundOff(event) {
    if (event.target.checked) {
      gTotal.innerHTML = Math.round(mReceipt.getGrandTotal());
    } else {
      gTotal.innerHTML = mReceipt.getGrandTotal();
    }
  }
</script>
