<link href="../assets/themes/sales_home_pages.css" rel="stylesheet" />
<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
<div class="container1" id="container1">
  <div id="tabwrap"></div>
  <div id="header"></div>
</div>
<div class="container" id="qwe">
  <input
    type="text"
    id="filter-text-box"
    placeholder="Type a keyword.."
    oninput="onFilterTextBoxChanged()"
  />
  <div id="wrapper1" class="ag-theme-alpine"></div>
</div>
<script>
  $("#this_month").prop("selectedIndex", -1);

  PaymentInHomeactionbar = new Actionbar();
  PaymentInHomeactionbar.addIcon(
    "add_paymentIn",
    "../assets/images/add-expense.png",
    "Add Payment In"
  );
  function handler(event) {
    switch (event.target.id) {
      case "add_paymentIn":
        payInPopup();
        break;
    }
  }
  window.electronAPI.setTitle("PAYMENT IN");
  PaymentInHomeactionbar.render(document.getElementById("header"));
  PaymentInHomeactionbar.setToolbarOnClick(handler);
  var PaymentInHomeTab;
  if (PaymentInHomeTab == undefined) {
    PaymentInHomeTab = new Tabbar();
    PaymentInHomeTab.addTab("paymentin_head", "Payment In");
  }
  PaymentInHomeTab.render(document.getElementById("tabwrap"));
  // DATA GENERATION
  var _randNum1 = (size) => Math.random() * size;
  var _zeroPad1 = (num) => (num < 10 ? "0" + num : num);
  var _generateDate = () => {
    var day = Math.round(_randNum(27)) + 1;
    var month = Math.round(_randNum(11)) + 1;
    var year = Math.round(_randNum(70)) + 1950;
    return `${_zeroPad(day)}/${_zeroPad(month)}/${year}`;
  };
  function createRowData(maxRows) {
    let rowData = [];
    for (var i = 0; i < maxRows; i++) {
      var row = {
        date: _generateDate(),
      };
      rowData.push(row);
    }
    return rowData;
  }
  // DATE COMPARATOR FOR SORTING
  function dateComparator(date1, date2) {
    var date1Number = _monthToNum(date1);
    var date2Number = _monthToNum(date2);
    if (date1Number === null && date2Number === null) {
      return 0;
    }
    if (date1Number === null) {
      return -1;
    }
    if (date2Number === null) {
      return 1;
    }

    return date1Number - date2Number;
  }
  // HELPER FOR DATE COMPARISON
  function _monthToNum(date) {
    if (date === undefined || date === null || date.length !== 10) {
      return null;
    }
    var yearNumber = date.substring(6, 10);
    var monthNumber = date.substring(3, 5);
    var dayNumber = date.substring(0, 2);
    var result = yearNumber * 10000 + monthNumber * 100 + dayNumber;
    // 29/08/2004 => 20040829
    return result;
  }
  // DATA FORMATTING
  function dateFormatter(params) {
    var dateAsString = params.data.date;
    var dateParts = dateAsString.split("/");
    return `${dateParts[0]} - ${dateParts[1]} - ${dateParts[2]}`;
  }
  var payIngrid = {
    // define 3 columns
    columnDefs: [
      { headerName: "REF NO", field: "0" },
      { headerName: "Party Name ", field: "1" },
      { headerName: "Catogory Name", field: "2" },
      { headerName: "Type", field: "3" },
      { headerName: "Total", field: "4" },
      { headerName: "Received/Paid", field: "5" },
      { headerName: "Balance", field: "6" },
      {
        headerName: "Date Formatted",
        field: "date",
        valueFormatter: dateFormatter,
        comparator: dateComparator,
        filter: "agDateColumnFilter",
        floatingFilter: true,
        floatingFilterComponentParams: {
          suppressFilterButton: true,
        },
        filterParams: {
          debounceMs: 500,
          suppressAndOrCondition: true,
          comparator: function (filterLocalDateAtMidnight, cellValue) {
            if (cellValue == null) {
              return 0;
            }
            var dateParts = cellValue.split("/");
            var year = Number(dateParts[2]);
            var month = Number(dateParts[1]) - 1;
            var day = Number(dateParts[0]);
            var cellDate = new Date(year, month, day);
            if (cellDate < filterLocalDateAtMidnight) {
              return -1;
            } else if (cellDate > filterLocalDateAtMidnight) {
              return 1;
            } else {
              return 0;
            }
          },
        },
      },
    ],
    // getSelectedRows: 'getSelectedRows',
    // cellClicked:'onCellClicked',
    // onSelectionChanged: 'onSelectionChanged',
    onFirstDataRendered: onFirstDataRendered,
    defaultColDef: {
      sortable: true,
      flex: 1,
      floatingFilter: true,
    },
    pagination: true,
    paginationPageSize: 10,
    rowSelection: "single", // allow rows to be selected
    animateRows: true,
  };
  function onFirstDataRendered(params) {
    params.api.sizeColumnsToFit();
  }
  var payIngridDiv = document.getElementById("wrapper1");
  new agGrid.Grid(payIngridDiv, payIngrid);
  window.MainDatastream.streampurchasehomeview((status, data) => {
    payIngrid.api.setRowData(JSON.parse(data).data);
  });
  function setDime(w, h) {
    if (w != undefined) {
      $("#wrapper1").css("width", (w * 96.1) / 100);
      $("#wrapper1").css("height", (h * 87) / 100);
    } else console.log("dime not defined");
  }
  try {
    setDime(window.screen.availWidth, window.screen.availHeight);
  } catch (err) {
    console.log("-dime not defined");
  }
</script>
