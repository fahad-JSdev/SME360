<link href="../assets/themes/sales_home_pages.css" rel="stylesheet" />
<div class="container1" id="container1">
  <div id="tabwrap"></div>

  <div id="header"></div>
</div>
<div class="container" id="qwe">
  <!-- <div class="table1-div">
    <br />
    
    <button id="add-purchase-order" onclick="openPO()">
      <span>Add Purchase Order</span>
    </button>
  </div> -->
  <input
    type="text"
    id="filter-text-box"
    placeholder="Type a keyword.."
    oninput="onFilterTextBoxChanged()"
  />
  <div id="wrapper1" class="ag-theme-alpine"></div>
</div>

<script>
  PurHomeactionbar = new Actionbar();

  // PurHomeactionbar.addIcon(
  //   "add_expense",
  //   "../src/assets/images/add-expense.png"
  // );

  // PurHomeactionbar.addIcon(
  //   "print_button",
  //   "../src/assets/images/toolbar-print.png"
  // );

  window.electronAPI.setTitle("SALES");
  PurHomeactionbar.render(document.getElementById("header"));
 

  var salesHomeTab;
  if (salesHomeTab == undefined) {
    salesHomeTab = new Tabbar();
    salesHomeTab.addTab("sales_head", "Sales");
  }
  salesHomeTab.render(document.getElementById("tabwrap"));

  var clickdata_id;
  function onFilterTextBoxChanged() {
    Salesgrid.api.setQuickFilter(
      document.getElementById("filter-text-box").value
    );
  }
  var BtnCellRenderer;
  if (typeof BtnCellRenderer !== "function") {
    BtnCellRenderer = class {
      init(params) {
        this.params = params;
        this.btnClickedHandler = this.btnClickedHandler.bind(this);
        this.eGui.addEventListener("click", this.btnClickedHandler);
      }

      getGui() {
        return this.eGui;
      }

      btnClickedHandler(event) {
        this.params.clicked(this.params.value);
        clickdata_id = this.params.data[1];

        var query =
          "SELECT p.po_date,p.total_amount,p.type,p.status,p.quantity,p.unitprice,p.discount,p.discount_percentage,p.payment_method,p.description,p.vendor_f_id,p.stock_f_id,p.order_id FROM purchase_order AS p WHERE p.order_id=" +
          clickdata_id +
          ";";

        window.MainDatastream.streampurchasegetdata(query, (status, data) => {
          // function qwe(){return JSON.parse(data).data}
          window.result_order = JSON.parse(data).data;
          ConvertArray();
          window.MainDatastream.streamconvertbill(
            sqlquerry,
            result,
            (status, data) => {
            }
          );
        });
        var result;

        function ConvertArray() {
          result = "('";

          for (var i = 0; i < window.result_order[0].length; i++) {
            if (window.result_order[0][i] != null)
              result = result + window.result_order[0][i];

            if (i == window.result_order[0].length - 1) {
              result = result + "')";
            } else {
              result = result + "','";
            }
          }
        }

     
      }

      destroy() {
        this.eGui.removeEventListener("click", this.btnClickedHandler);
      }
    };
  }

  var Salesgrid = {
    // define 3 columns
    columnDefs: [
    { headerName: "No",  valueGetter: "node.rowIndex + 1", resizable: true },
      { headerName: "Party", field: "0", resizable: true },
      { headerName: "Date", field: "1", resizable: true },
      { headerName: "Due Date", field: "2", resizable: true },
      { headerName: "Total Amount", field: "3", resizable: true },
      { headerName: "Payment Type", field: "4", resizable: true },
      { headerName: "Status", field: "5", resizable: true },
    ],
    onFirstDataRendered: onFirstDataRendered,
    defaultColDef: { sortable: true},
    pagination: true,
    paginationPageSize: 10,
    rowSelection: "single", // allow rows to be selected
    animateRows: true,
  };
  function onFirstDataRendered(params) {
    params.api.sizeColumnsToFit();
  }
  var SalesGridDiv = document.getElementById("wrapper1");
  new agGrid.Grid(SalesGridDiv, Salesgrid);

  var salesHome_query =
    "SELECT cust.client_name,q.issue_date,q.due_date,q.total_amount,q.payment_type,q.status FROM quotation AS q LEFT JOIN customer AS cust ON q.customer_f_key=cust.client_id WHERE q.is_deleted = '0' UNION ALL select cust.client_name,i.issue_date_in,i.due_date_in,i.total_amount_in,i.payment_type_in,i.status from invoice as i LEFT JOIN customer AS cust ON i.customer_f_key=cust.client_id WHERE i.is_deleted = '0';";
  window.MainDatastream.streamGetData(salesHome_query, (status, data) => {
    Salesgrid.api.setRowData(JSON.parse(data).data);
  });

  function setDime(w, h) {
    if (w != undefined) {
      $("#wrapper1").css("width", (w * 96) / 100);
      $("#wrapper1").css("height", (h * 86) / 100);
    } else console.log("dime not defined");
  }

  try {
    setDime(window.screen.availWidth, window.screen.availHeight);
  } catch (err) {
    console.log("-dime not defined");
  }
</script>